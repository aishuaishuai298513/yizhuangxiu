//
//  My_pocket_index_ViewController.m
//  zhaiyi
//
//  Created by mac on 15/12/5.
//  Copyright © 2015年 apple. All rights reserved.
//

#import "My_pocket_index_ViewController.h"
#import "My_pocket_Hongbao_ViewController.h"
#import "My_pocket_tixian_ViewController.h"
#import "My_pocket_jiaoyijilu_ViewController.h"
#import "My_pocket_recharge_Controller.h"


@interface My_pocket_index_ViewController ()
<UITableViewDataSource,UITableViewDelegate>

{
    UITableView * tb;
//    NSString *_lx;
    NSString *_moneyText;
    
    //储存钱数
    
    
    ADAccount *_account;
}
@property (strong, nonatomic) NSMutableDictionary *params;
@property (strong, nonatomic) NSMutableDictionary *modifyDict;


@end

@implementation My_pocket_index_ViewController


- (void)viewDidLoad {
    [super viewDidLoad];
    self.title=@"钱包";
    
     [self MakeUI];
 }
-(void)viewWillAppear:(BOOL)animated{
    [super viewWillAppear:animated];
    
    _account = [ADAccountTool account];
    _modifyDict = [ADAccountTool backWitDictionary];
    
    [self getMoneyData];
}


-(void)card
{
    UIStoryboard *secondStoryBoard = [UIStoryboard storyboardWithName:@"employersInMy" bundle:nil];
    UIViewController* test2obj = [secondStoryBoard instantiateViewControllerWithIdentifier:@"card"];
    [self.navigationController pushViewController:test2obj animated:YES];
}
-(void)MakeUI
{
    self.view.backgroundColor=[UIColor whiteColor];
    
    //
    UIButton *rightButton = [UIButton buttonWithType:UIButtonTypeCustom];
    [rightButton setBackgroundImage:[UIImage imageNamed:@"右上角按钮"] forState:UIControlStateNormal];
    [rightButton setTitle:@"银行卡" forState:UIControlStateNormal];
    [rightButton setTitleColor:[UIColor blackColor] forState:UIControlStateNormal];
    rightButton.titleLabel.font = [UIFont systemFontOfSize:15];
    [rightButton addTarget:self action:@selector(card) forControlEvents:UIControlEventTouchUpInside];
    rightButton.frame = CGRectMake(0, 0, 84, 30);
    UIBarButtonItem *rightItem = [[UIBarButtonItem alloc]initWithCustomView:rightButton];
    self.navigationItem.rightBarButtonItem = rightItem;
    //
    _modifyDict = [NSMutableDictionary dictionary];
    _params = [NSMutableDictionary dictionary];
    
    
    tb=[[UITableView alloc]initWithFrame:CGRectMake(0, 0, kU , Ga-64)];
    tb.delegate=self;
    tb.dataSource=self;
    [self.view addSubview:tb];
    
    [self MJPullRefresh];
}
-(void)MJPullRefresh{
    
    tb.mj_header = [MJRefreshNormalHeader headerWithRefreshingBlock:^{
        
        [self getMoneyData];
    }];
}


#pragma mark  tableView
-(NSInteger)numberOfSectionsInTableView:(UITableView *)tableView{
    NSLog(@"计算分组数");
    return 1;
}

#pragma mark 返回每组行数
-(NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section{
    if ([_account.type isEqualToString:@"78"]) {
        return 4;
    }else {
        return 5;
    }

}

#pragma mark返回每行的单元格
-(UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath{
    tb.separatorStyle=UITableViewCellSeparatorStyleNone;
    if (indexPath.row==0) {
        UITableViewCell * cell;
        if (!cell) {
            cell=[[UITableViewCell alloc]init];
            cell.selectionStyle=UITableViewCellSelectionStyleNone;
        }
        
        cell.contentView.backgroundColor=ZYgreenColor;
        
        UIButton * zhye=[[UIButton alloc]initWithFrame:CGRectMake(kU/3, 38, kU/3, 25)];
        [zhye setImage:[UIImage imageNamed:@"qianbao.png"] forState:UIControlStateNormal];
        [zhye setTitle:@" 账户余额" forState:UIControlStateNormal];
        zhye.titleLabel.font = [UIFont systemFontOfSize: 15.0];
        [cell.contentView addSubview:zhye];
        
        UILabel * money=[[UILabel alloc]initWithFrame:CGRectMake(0, 70, kU, 50)];
        
        if ([_account.type isEqualToString:@"78"]) {
            money.text=[NSString stringWithFormat:@"￥%@",_account.money];
        } else {
            money.text=[NSString stringWithFormat:@"￥%@",_account.recharge_money];
        }
        money.textColor=[UIColor whiteColor];
        money.textAlignment=NSTextAlignmentCenter;
        money.font=[UIFont systemFontOfSize:45];
        [cell.contentView addSubview:money];
        
        return cell;
        
    }else
    {
        UITableViewCell *cell1=[tableView dequeueReusableCellWithIdentifier:@"cell1"];
        if (!cell1) {
            cell1=[[UITableViewCell alloc]init];
        }
        UILabel * title=[[UILabel alloc]initWithFrame:CGRectMake(10, 20, 100, 20)];
        title.font=[UIFont systemFontOfSize:17];
        [cell1.contentView addSubview:title];
        NSArray * name;
        if ([_account.type isEqualToString:@"78"]) {
            name=@[@"红包",@"提现",@"交易记录"];
        }else {
            name=@[@"红包",@"充值",@"提现",@"交易记录"];

        }
        title.text=name[indexPath.row-1];
        UIImageView * jt=[[UIImageView alloc]initWithFrame:CGRectMake(kU-30, 20, 10, 20)];
        jt.image=[UIImage imageNamed:@"right.png"];
        [cell1.contentView addSubview:jt];
        
        UIView * view=[[UIView alloc]initWithFrame:CGRectMake(10, 59, kU-10, 1)];
        view.backgroundColor=[UIColor myColorWithString:@"f4f4f4"];
        [cell1.contentView addSubview:view];
        return cell1;
        
    }
}

-(CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath
{
    if (indexPath.row==0) {
        return 180;
    }else
    {
        return 60;
    }
    
}
-(void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath
{
    if (indexPath.row==1) {
        My_pocket_Hongbao_ViewController *hb=[[My_pocket_Hongbao_ViewController alloc]init];
        [self.navigationController pushViewController:hb animated:YES];
    }else if(indexPath.row==2)
    {
        if ([_account.type isEqualToString:@"78"]) {
            My_pocket_tixian_ViewController *hb=[[My_pocket_tixian_ViewController alloc]init];
            [self.navigationController pushViewController:hb animated:YES];
        }else{
            My_pocket_recharge_Controller *recharge = [[My_pocket_recharge_Controller alloc]init];
            [self.navigationController pushViewController:recharge animated:YES];
        }
        
        //        NSLog(@"充值");
    }else if(indexPath.row==3)
    {
        if ([_account.type isEqualToString:@"78"]) {
            My_pocket_jiaoyijilu_ViewController * hb=[My_pocket_jiaoyijilu_ViewController new];
            [self.navigationController pushViewController:hb animated:YES];
        }else{
            My_pocket_tixian_ViewController *hb=[[My_pocket_tixian_ViewController alloc]init];
            [self.navigationController pushViewController:hb animated:YES];
        }
        
    }else
    {
        My_pocket_jiaoyijilu_ViewController * hb=[My_pocket_jiaoyijilu_ViewController new];
        [self.navigationController pushViewController:hb animated:YES];
    }
}
- (void)didReceiveMemoryWarning {
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}

/*
 #pragma mark - Navigation
 
 // In a storyboard-based application, you will often want to do a little preparation before navigation
 - (void)prepareForSegue:(UIStoryboardSegue *)segue sender:(id)sender {
 // Get the new view controller using [segue destinationViewController].
 // Pass the selected object to the new view controller.
 }
 */
//钱包
-(void)getMoneyData{
    
    [_params setObject:_account.type forKey:@"type"];
    [_params setObject:_account.userid forKey:@"user_id"];
    
    [NetWork postNoParm:POST_REMAIN_MONEY params:_params success:^(id responseObj) {
        NSLog(@"请求的金额 %@",responseObj);
        if ([[responseObj objectForKey:@"code"]isEqualToString:@"1000"]) {
            NSDictionary *dict = [responseObj objectForKey:@"data"];
            if ([_account.type isEqualToString:@"78"]) {
                NSLog(@"金额:  %@",[responseObj objectForKey:@"data"]);
                NSString *money = dict[@"money"];
                [_modifyDict setObject:money forKey:@"money"];

            } else {
                NSLog(@"金额:  %@",[responseObj objectForKey:@"data"]);
                NSString *recharge_money = dict[@"recharge_money"];
                [_modifyDict setObject:recharge_money forKey:@"recharge_money"];
                
                
            }
            _account = [ADAccount accountWithDict:_modifyDict];
            [ADAccountTool save:_account];
            [tb reloadData];
            [tb.mj_header endRefreshing];
        }
        
    } failure:^(NSError *error) {
        NSLog(@"请求的金额 %@",error.localizedDescription);
        [tb.mj_header endRefreshing];
    }];
    
    
}


@end
